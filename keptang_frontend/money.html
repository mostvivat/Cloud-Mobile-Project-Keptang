<!DOCTYPE html>
<html lang="en">

<head>
  <style>
    html,
    body {
      height: 97%;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .bg-light {
      flex: 1;
      /* height: 100%; */
      width: 100%;
      padding-bottom: 3rem;
      background-image: url('image.png');
      background-position: center;
    }

    @media (min-width: 992px) {
      .bg-light {
        padding-top: 4rem;
      }
    }

    .pt-0 {
      padding-top: 0 !important;
    }

    .my-2 {
      margin-top: 2rem !important;
      margin-bottom: 2rem !important;
    }

    .text-center {
      text-align: center !important;
    }

    .col-lg-6 {
      max-width: 50% !important;
    }

    .lead {
      font-size: 1.25rem !important;
    }

    .col-md-6 {
      max-width: 50% !important;
    }

    .col-md-5 {
      max-width: 41.6667% !important;
    }
  </style>

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
      crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
      crossorigin="anonymous"></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
    <!-- <link href="headers.css" rel="stylesheet"> -->
    <title>หน้าหลัก</title>

  </head>

<body class="mx-5" onload="getData()" style="background-color:#B2A4FF;">
  <header style="background-color:#B2A4FF ;">
    <div div class="row">
      <div class="col-6">
        <ul class="nav justify-content-lg-start">
          <li><a href="money.html" class="nav-link px-2 text-warning fs-5">หน้าหลัก</a></li>
          <li><a href="moneytoday.html" class="nav-link px-2 text-white fs-5">รายรับ/รายจ่ายวันนี้</a></li>
          <li><a href="moneyadd.html" class="nav-link px-2 text-white fs-5">เพิ่มรายรับ/รายจ่าย</a></li>
        </ul>
      </div>
      <div class="col-6">
        <ul class="nav justify-content-end">
          <li><a href="profile.html" class="nav-link px-2 text-white fs-5">โปรไฟล์</a></li>
        </ul>
      </div>
    </div>
  </header>
  <div class="bg-light">
    <div class="pt-0 my-2 text-center ">
      <h1 class="display-4 fw-bold text-body-emphasis ">Keptang</h1>
      <div class="col-lg-6 mx-auto">
        <p class="lead mb-4">เว็บสรุปรายรับรายจ่าย</p>
      </div>
      <div class="my-5 col-md-6">
        <h1>Overview</h1>
      </div>
    </div>
    <div class=" mt-2 p-2">
      <div class="container">

        <div class="row">
          <!-- Column 1 -->
          <div class="col-md-6 text-center">
            <h4>ยอดเงินคงเหลือทั้งหมด: <span id="totalbalance" class="bg-warning px-3 rounded"> บาท</span></h4>
            <h4>ยอดเงินคงเหลือทั้งหมดวันนี้: <span id="todaybalance" class="bg-warning px-3 rounded"> บาท</span></h4>
          </div>
          <!-- Column 2 -->
          <div class="col-md-6 text-center">
            <h4>รายรับทั้งหมด: <span id="incomebalance" class="bg-success px-3 rounded text-light"> บาท</span></h4>
            <h4>รายจ่ายทั้งหมด: <span id="expensebalance" class="bg-danger px-3 rounded text-light"> บาท</span></h4>
          </div>

        </div>
        <div class="row mt-4 fs-4 text-center">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">วันที่</th>
                <th scope="col">ประเภท</th>
                <th scope="col">จำนวนเงิน</th>
                <th scope="col">หมายเหตุ</th>
                <th scope="col">Action</th>

              </tr>
            </thead>
            <tbody id="history">
              <tr>
                <form action="" method="post">
                  <td>-</td>
                  <td>API Error</td>
                  <td>-</td>
                  <td>-</td>
                  <input type="hidden" name="id">
                  <td><button class="btn btn-primary bi bi-pencil-square" type="submit">Edit</button></td>
                </form>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>

  <script>
    function getData() {
      const userid = 40956;
      fetch(`http://localhost:8080/money/${userid}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        },
        // body: JSON.stringify(data)
      })

        .then(response => response.json())
        .then(data => {
          console.log(data);
          const todaybalance = data[0].balance_today;
          const totalbalance = data[0].balance_total;
          document.getElementById('totalbalance').textContent = totalbalance.toLocaleString() + " บาท";
          document.getElementById('todaybalance').textContent = todaybalance.toLocaleString() + " บาท";



          // Create a table to display the items list
          let itemsTable = '';
          let pay = 0;
          let receive = 0;
          let x = data[0].items.map(item => item.list_id);
          for (let i = data[0].items.length-1; i >= 0; i--) {
            const item = data[0].items[i];
            itemsTable += '<tr><td>' + item.date + '</td><td>' + (item.types=="expense"?"รายจ่าย":"รายรับ") + '</td><td>' + item.amount.toLocaleString() + " บาท" + '</td><td>' + item.description + '</td><td><button class="btn btn-primary bi bi-pencil-square mx-3" onclick="editData(' + x[i] + ')"> Edit</button><button class="btn btn-danger bi bi-trash" onclick="deleteData(' + x[i] + ')"> Delete</button></td></tr>';
            if (item.types === "expense") {
              pay += item.amount;
            } else if (item.types === "income") {
              receive += item.amount;
            }
          }

          document.getElementById('incomebalance').textContent = receive.toLocaleString() + " บาท";
          document.getElementById('expensebalance').textContent = pay.toLocaleString() + " บาท";

          // Set the items table in the HTML element with id "itemslist"
          document.getElementById('history').innerHTML = itemsTable;
        });
    }

        //window.addEventListener('load', getData);
  </script>
</body>

</html>

<script>
  function editData(list_id) {
    window.location.href = 'moneyedit.html?list_id=' + list_id;
  }
</script>

<script>
  function deleteData(list_id) {
    if (confirm("คุณยืนยันที่จะลบใช่หรือไม่")) {
  
    const data = {
      user_id: 40956
    };
    const url = `http://localhost:8080/money/item/${list_id}`;
    const options = {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    };
    fetch(url, options)
  .then(response => response.text())
  .then(data => {
    alert(data);
    location.reload();
  })
  .catch(error => console.error(error));
    }
  }

</script>